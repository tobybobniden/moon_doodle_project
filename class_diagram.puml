@startuml Moon Phase Strategy - Class Diagram

title Moon Phase Strategy - é¡åˆ¥åœ–

!theme plain
skinparam backgroundColor #ffffff
skinparam classBackgroundColor #f0f0f0
skinparam classBorderColor #333333
skinparam classArrowColor #333333
skinparam fontSize 11

' ============================================
' AI ç©å®¶æ¡†æ¶
' ============================================
abstract class AIPlayer {
    - name: str
    --
    + __init__(name: str)
    + {abstract} decide_move(game_state: dict, player: str): tuple
}

class RandomAI {
    - name: str (inherited)
    --
    + decide_move(game_state: dict, player: str): tuple
}

class GreedyAI {
    - name: str (inherited)
    --
    + decide_move(game_state: dict, player: str): tuple
    - _evaluate_move(node_id: int, card_val: int, nodes: dict, adj_map: dict): int
}

AIPlayer <|-- RandomAI : ç¹¼æ‰¿
AIPlayer <|-- GreedyAI : ç¹¼æ‰¿

' ============================================
' éŠæˆ²é‚è¼¯ (Model)
' ============================================
class MoonPhaseGame {
    - adj_map: dict
    - nodes: dict {node_id: {'val': int, 'owner': str}}
    - scores: dict {'P1': int, 'P2': int}
    - deck: list [int]
    - hands: dict {'P1': [int], 'P2': [int]}
    - turn: str
    - game_over: bool
    --
    + __init__(adj_map: dict)
    - _draw(): int
    + get_chains(start_node: int, current_val: int, step: int, visited: list): list
    + calculate_impact(node_id: int, current_val: int, player: str): int
    + play_move(node_id: int, card_idx: int): bool
}

' ============================================
' è¦–è¦ºåŒ–çµ„ä»¶ (View)
' ============================================
class GameBoardWidget {
    - game: MoonPhaseGame
    - adj_map: dict
    - pos: dict (NetworkX coordinates)
    - node_radius: int
    - padding: int
    --
    + __init__(adj_map: dict, game_instance: MoonPhaseGame)
    + get_screen_coords(nx_coords: tuple): QPoint
    + paintEvent(event: QPaintEvent)
    + mousePressEvent(event: QMouseEvent)
    --
    node_clicked(nid: int) <<signal>>
}

' ============================================
' ä¸»æ§åˆ¶å™¨ (Controller)
' ============================================
class MainWindow {
    - game: MoonPhaseGame
    - board_widget: GameBoardWidget
    - ai_players: dict {str: AIPlayer}
    - selected_card_idx: int
    - game_ended: bool
    - hand_btns: list [QPushButton]
    - hand_buttons_layout: QHBoxLayout
    - game_control_container: QWidget
    - game_over_container: QWidget
    --
    - lbl_p1_score: QLabel
    - lbl_p2_score: QLabel
    - lbl_turn: QLabel
    - lbl_hand_msg: QLabel
    - lbl_result: QLabel
    - btn_retry: QPushButton
    --
    + __init__(ai_players: dict = None)
    + update_ui()
    + execute_ai_move()
    + select_card(idx: int)
    + on_node_click(node_id: int)
    + show_game_over()
    + restart_game()
}

' ============================================
' é—œä¿‚
' ============================================

MainWindow --> MoonPhaseGame : åŒ…å«
MainWindow --> GameBoardWidget : åŒ…å«
MainWindow --> AIPlayer : ä½¿ç”¨ (ai_players)

GameBoardWidget --> MoonPhaseGame : åƒè€ƒ
GameBoardWidget --|> QWidget

MainWindow --|> QMainWindow

MoonPhaseGame ..> AIPlayer : ä¸ç›´æ¥ç›¸é—œ

' ============================================
' å·¥å…·å‡½æ•¸èˆ‡å¸¸æ•¸
' ============================================
note right of AIPlayer
  å·¥å…·å‡½æ•¸èˆ‡å¸¸æ•¸ï¼š
  â€¢ phase_to_color(phase_index: int) -> QColor
    å°‡æœˆç›¸ç´¢å¼•æ˜ å°„åˆ° HSL æ¼¸å±¤è‰²
  â€¢ PHASES: ["ğŸŒ‘", "ğŸŒ’", ..., "ğŸŒ˜"] (8å€‹æœˆç›¸)
  â€¢ OWNER_COLORS: dict (P1ç¶ è‰², P2ç²‰ç´…, Noneç°è‰²)
  â€¢ CUSTOM_ADJ_MAP: dict (14ç¯€é»åœ–çµæ§‹)
end note

' ============================================
' èª¬æ˜
' ============================================
note bottom
  MVCæ¶æ§‹èªªæ˜ï¼š
  â€¢ Model: MoonPhaseGame (éŠæˆ²é‚è¼¯)
  â€¢ View: GameBoardWidget (åœ–å½¢åŒ–å±•ç¤º)
  â€¢ Controller: MainWindow (äº‹ä»¶è™•ç†)
  â€¢ AIå±¤: AIPlayeræ¡†æ¶ (å¯æ’æ‹”å¼AIæ§åˆ¶)
end note

@enduml
